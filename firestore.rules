
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Rules for the 'courseData' collection
    match /courseData/{docId} {
      // Anyone can read (get/list) the course data.
      allow get, list: if true;
      
      // Only authenticated admins can write (create/update/delete).
      allow write: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }

    // Rules for the 'users' collection
    match /users/{userId} {
      // Users can create their own document (on signup).
      // They can also read their own data.
      // Admins can read any user document.
      allow read, create: if request.auth.uid == userId 
          || (request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
          
      // Users can only update their own document. Admins can update any.
      allow update: if request.auth.uid == userId 
          || (request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
          
      // Only admins can delete user documents.
      allow delete: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}
